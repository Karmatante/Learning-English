<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pen Pal Letter – Hover Vocabulary</title>

  <!-- Dyslexivänligt typsnitt (Lexend). Fallback till OpenDyslexic om installerat lokalt. -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;600&display=swap" rel="stylesheet">

  <style>
    html, body{ width:100%; margin:0; padding:0; }
    *, *::before, *::after{ box-sizing:border-box; }

    body{
      font-family: "OpenDyslexic", "Lexend", Arial, sans-serif;
      font-size: 22px;
      line-height: 1.7;
      padding: 20px;
      max-width: none;
      background: #fff;
      color: #111;
    }

    .page{ width:100%; max-width:100%; }

    h1{
      margin: 0 0 10px 0;
      font-size: 25px;
      line-height: 1.3;
    }

    .small{
      font-size: 14px;
      color: #444;
      margin: 0 0 21px 0;
    }

    h2{
      font-size: 22px;
      margin: 0 0 16px 0;
      font-weight: 600;
      line-height: 1.7;
    }

    p{ margin: 0 0 16px 0; }
    p:last-child{ margin-bottom: 0; }

    /* Endast ord/fraser med översättning får understreck */
    .w{
      position: relative;
      cursor: help;
      border-bottom: 1px dotted #666;
      padding: 0 1px;
    }

    .w:hover::after, .w:focus::after{
      content: attr(data-sv);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 140%;
      background: #111;
      color: #fff;
      padding: 6px 8px;
      border-radius: 8px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 10;
      max-width: 420px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .w:hover::before, .w:focus::before{
      content: "";
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 120%;
      border: 6px solid transparent;
      border-top-color: #111;
      z-index: 10;
    }

    /* Ljudspelare (Drive preview) */
    .audio{ margin: 0 0 18px 0; }
    .audio iframe{
      width: 100%;
      height: 90px;
      border: 0;
      border-radius: 12px;
      overflow: hidden;
      display: block;
      background: #f6f6f6;
    }
  </style>
</head>

<body>
  <div class="page">
    <h1>Read about Alex</h1>
    <div class="small">Hovra över markerade ord för svensk översättning.</div>

    <div class="audio" id="audioWrap" style="display:none;">
      <iframe id="audioFrame" allow="autoplay"></iframe>
    </div>

    <div id="out" aria-label="Text med hover-översättning"></div>
  </div>

  <script>
    /* =========================
       DU ÄNDRAR ENDAST HÄR
       ========================= */

    // A) Drive-filens ID
    const DRIVE_FILE_ID = "197lNgZ1vzreRQqsr7C6lyzNRze8TvY0n";

    // B) Ordlista: engelska = svenska (exakt som du gav)
    const RAW_LIST = `
a = en / ett
about = om
friendly = vänlig
years = år
alex = Alex
also = också
always = alltid
am = är
and = och
any = några / någon
are = är
ask = fråga
at = på
best = bästa 
wishes = önskningar 
better = bättre
brown = brun
but = men
because = eftersom
challenging = utmanande
confident = självsäker
countries = länder
curious = nyfiken
demanding = krävande
dear = kära
do = göra
dog = hund
energetic = energisk
english = engelska
enjoy = tycka om
especially = särskilt
excited = exalterad
family = familj
favourite = favorit
feel = känna
films = filmer
football = fotboll
free = fri
friends = vänner
from = från
games = spel
have = ha
he = han
hear = höra
hello = hej
helps = hjälper
her = hennes
his = hans
hope = hoppas
i = jag
important = viktig
in = i
interesting = intressanta
is = är
it = det
kind = snäll
laugh = skratta
learn = lära
life = liv
like = gilla
listening = lyssna
little = liten
live = bo
loyal = lojal
lot = mycket
makes = gör
many = många
time = tid
me = mig
learning = lära sig
other = andra
want = vilja ha
what = vad
brothers = brödrar
sisters = systrar
soon = snart
meet = möta
music = musik
my = min
name = namn
near = nära
new = nya
now = nu
of = av
often = ofta
old = gammal
one = en
or = eller
others = andra
pal = brevvän
people = människor
pets = husdjur
playing = spela
playful = lekfull
questions = frågor
quite = ganska
relax = slappna av
sad = ledsen
school = skola
sea = hav
secondary = högstadie-
she = hon
shy = blyg
sister = syster
small = liten
so = så
some = vissa
sometimes = ibland
speaking = tala
stressed = stressad
still = fortfarande
strong = stark
student = elev
subjects = ämnen
supportive = stöttande
talks = pratar
than = än
the = den / det
them = dem
they = de
tired = trött
to = att / till
together = tillsammans
town = stad
try = försöka
very = väldigt
video = video
watching = titta på
we = vi
when = när
where = var
white = vit
who = vem
with = med
wish = önskningar
words = ord
write = skriva
year = år
you = du
younger = yngre
your = din
    `.trim();

    // C) Texten
    const TEXT = `
Dear Pen Pal,

Hello. My name is Alex, and I am 13 years old. I am from Sweden, and I live in a small town near the sea. I am a student in secondary school, and I am in year 7. I am quite friendly, but sometimes I am a little shy when I meet new people. Still, I like to learn about others, so I am excited to write to you.

I have a small family. I have one sister, and she is younger than me. She is very energetic and talks a lot. I also have a dog. His name is Max, and he is brown and white. He is playful and loyal, and he always makes me feel better when I am tired or sad.

In my free time, I like listening to music and playing football. Music helps me relax, especially when I feel stressed. Football is important to me because it makes me feel strong and confident. I also enjoy watching films and playing video games with my friends. They are kind and supportive, and we often laugh together.

At school, I have many subjects. Some of them are interesting, and some are challenging. English is one of my favourite subjects because I like learning new words and speaking to people from other countries. Sometimes school is demanding, but I try my best.

Now I want to ask you some questions. Who are you? Where are you from? What do you like to do in your free time? Do you have any brothers, sisters, or pets? How do you feel about school?

I hope to hear from you soon. I am curious about your life.

Best wishes,
Alex
    `.trim();

    /* =========================
       INGEN ÄNDRING UNDER HÄR
       ========================= */

    function normalizeKey(raw){
      return raw.trim().replace(/\s+/g, " ").toLocaleLowerCase("en-US");
    }

    function buildDict(raw){
      const dict = {};
      raw.split("\n").forEach(line => {
        const trimmed = line.trim();
        if(!trimmed) return;

        const idx = trimmed.indexOf("=");
        if(idx === -1) return;

        const left = trimmed.slice(0, idx).trim();
        const right = trimmed.slice(idx + 1).trim();
        if(!left || !right) return;

        dict[normalizeKey(left)] = right;
      });
      return dict;
    }

    // Tokeniserar och behåller skiljetecken/mellanslag
    function tokenize(text){
      const re = /[A-Za-z]+(?:-[A-Za-z]+)*|[0-9]+|\s+|[^A-Za-z0-9\s]+/g;
      return text.match(re) || [];
    }

    function isWord(tok){
      return /^[A-Za-z]+(?:-[A-Za-z]+)*$/.test(tok) || /^[0-9]+$/.test(tok);
    }

    function renderInline(container, text, dict){
      const tokens = tokenize(text);

      let i = 0;
      while(i < tokens.length){
        const tok = tokens[i];

        if(!isWord(tok)){
          container.appendChild(document.createTextNode(tok));
          i += 1;
          continue;
        }

        const key = normalizeKey(tok);
        const sv = dict[key];

        if(sv){
          const span = document.createElement("span");
          span.className = "w";
          span.textContent = tok;
          span.setAttribute("tabindex", "0");
          span.setAttribute("data-sv", sv);
          container.appendChild(span);
        } else {
          container.appendChild(document.createTextNode(tok));
        }

        i += 1;
      }
    }

    function setupAudio(){
      const wrap = document.getElementById("audioWrap");
      const frame = document.getElementById("audioFrame");
      if(!wrap || !frame) return;

      const id = (DRIVE_FILE_ID || "").trim();
      if(!id){
        wrap.style.display = "none";
        return;
      }

      frame.src = "https://drive.google.com/file/d/" + encodeURIComponent(id) + "/preview";
      wrap.style.display = "block";
    }

    function render(){
      setupAudio();

      const dict = buildDict(RAW_LIST);
      const out = document.getElementById("out");
      out.innerHTML = "";

      const clean = (TEXT || "").replace(/\r\n/g, "\n").trim();
      const blocks = clean.split(/\n\s*\n+/);

      blocks.forEach((block, idx) => {
        const blockText = block.replace(/\n+/g, " ").replace(/\s+/g, " ").trim();

        if(idx === 0){
          const h2 = document.createElement("h2");
          renderInline(h2, blockText, dict);
          out.appendChild(h2);
        } else {
          const p = document.createElement("p");
          renderInline(p, blockText, dict);
          out.appendChild(p);
        }
      });
    }

    render();
  </script>
</body>
</html>

